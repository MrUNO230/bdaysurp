<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, My Love!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" />
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background-color: #f0f0f0; /* Fallback, usually hidden by sections */
            color: #333;
            overflow: hidden; /* Prevents scrollbars */
            height: 100%;
        }

        .section {
            height: 100vh;
            width: 100vw;
            display: flex; /* Keep flex for content alignment */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: absolute; 
            top: 0;
            left: 0;
            opacity: 0; /* GSAP will control this via autoAlpha */
            visibility: hidden; /* GSAP will control this via autoAlpha */
            /* Ensure CSS transitions are OFF to prevent conflict with GSAP */
            /* transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out; */
            background-size: cover;
            background-position: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .particle-background-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 0; /* Behind content within the section */
        }

        .section h1,
        .section p,
        .section button {
            position: relative; /* To ensure they are in the stacking context */
            z-index: 1;  /* Above particle container */
        }

        /* The .active class is mainly a target for JS and a fallback if JS fails.
           GSAP handles the actual visibility for transitions. */
        .section.active {
            z-index: 1; /* Active section should be on top of non-active ones */
        }


        #loading-screen { background-color: #ffc0cb; }
        #welcome-screen { background-color: #add8e6; }
        #balloon-screen { background-color: #90ee90; }
        #gallery-screen { background-color: #fffacd; }
        #cake-screen { background-color: #ffdab9; }
        #message-screen { background-color: #dda0dd; }
        #song-screen { background-color: #f0e68c; }
        #final-screen { background-color: #e6e6fa; }

        h1 { font-size: 3em; color: #ff69b4; margin-bottom: 20px; }
        p { font-size: 1.2em; line-height: 1.6; }
        button { padding: 15px 30px; font-size: 1.2em; background-color: #ff69b4; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px; transition: background-color 0.3s ease; }
        button:hover { background-color: #ff1493; }
        .balloon-container { position: relative; width: 100%; height: 80%; overflow: hidden; }
        .balloon { position: absolute; width: 80px; height: 100px; background-color: red; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; display: flex; align-items: center; justify-content: center; font-size: 0.8em; color: white; cursor: pointer; box-shadow: inset -5px -5px 10px rgba(0,0,0,0.2); }
        .balloon::after { content: ''; position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); width: 2px; height: 40px; background: #555; }
        .swiper-container { width: 80%; max-width: 600px; height: auto; max-height: 70vh; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
        .swiper-slide img { display: block; width: 100%; height: auto; object-fit: contain; max-height: 65vh; }
        .swiper-slide p { font-size: 1em; color: #555; margin-top: 10px; }
        #cake-container { position: relative; width: 200px; height: 250px; }
        .cake-body { width: 100%; height: 150px; background-color: #f2d7b6; border-radius: 10px 10px 0 0; position: absolute; bottom: 0; border: 3px solid #d2b48c; }
        .icing { width: 105%; height: 40px; background-color: #fff0f5; position: absolute; top: -20px; left: -2.5%; border-radius: 50% / 20px; border: 2px solid #ffc0cb; }
        .candle { width: 10px; height: 40px; background-color: #fff; position: absolute; top: -50px; border: 1px solid #ccc; }
        .flame { width: 8px; height: 15px; background-color: orange; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; position: absolute; top: -12px; left: 1px; transform-origin: bottom center; }
        #candle1 { left: 30%; }
        #candle2 { left: 50%; transform: translateX(-50%); }
        #candle3 { left: 70%; transform: translateX(-100%);}
        #typed-message { font-size: 1.5em; min-height: 100px; width: 80%; max-width: 700px; background: rgba(255,255,255,0.7); padding: 20px; border-radius: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div id="loading-screen" class="section active"> <!-- Start with loading screen active in HTML -->
        <h1>Preparing Your Surprise...</h1>
        <p>Just a moment, my love!</p>
       <div id="particles-js-loading" class="particle-background-container"></div>
    </div>
    <div id="welcome-screen" class="section">
        <div id="particles-js-welcome" class="particle-background-container"></div>
        <h1 id="welcome-text">[Girlfriend's Name]!</h1>
        <p>This is a little something I made just for you.</p>
        <button onclick="nextSection()">Start Your Celebration!</button>
    </div>
    <div id="balloon-screen" class="section"><h1>Pop Some Joy!</h1><p>Click the balloons to reveal some birthday cheer!</p><div class="balloon-container" id="balloon-field"></div><button onclick="nextSection()">Next Surprise!</button></div>
    <div id="gallery-screen" class="section"><h1>Our Cherished Moments</h1><div class="swiper-container"><div class="swiper-wrapper"></div><div class="swiper-pagination"></div><div class="swiper-button-next"></div><div class="swiper-button-prev"></div></div><button onclick="nextSection()">Ready for Cake?</button></div>
    <div id="cake-screen" class="section"><h1>Make a Wish!</h1><div id="cake-container" onclick="blowOutCandles()"><div class="cake-body"><div class="icing"></div></div><div class="candle" id="candle1"><div class="flame" id="flame1"></div></div><div class="candle" id="candle2"><div class="flame" id="flame2"></div></div><div class="candle" id="candle3"><div class="flame" id="flame3"></div></div></div><p id="cake-message">Click the cake to blow out the candles!</p><button onclick="nextSection()" id="cake-next-button" style="display:none;">What's Next?</button></div>
    <div id="message-screen" class="section"><h1>A Little Note For You</h1><div id="typed-message-container"><p id="typed-message"></p></div><button onclick="nextSection()">One More Thing...</button></div>
    <div id="song-screen" class="section"><h1>Our Special Song</h1><p>Let this play for you...</p><audio id="birthday-song" controls loop><source src="birthday.mp3" type="audio/mpeg">Your browser does not support the audio element.</audio><p id="song-title">Song: [Her Favorite Song / Your Song Title]</p><button onclick="nextSection()">The Grand Finale!</button></div>
    <div id="final-screen" class="section"><h1>I Love You, [Girlfriend's Name]!</h1><p>I hope you have the most wonderful birthday ever. You deserve all the happiness in the world.</p><p>With all my love,<br>[Your Name]</p><button onclick="replaySurprise()">Replay the Surprise?</button></div>

    <script>
        // --- CONFIGURATION ---
        const girlfriendName = "My Sunshine"; 
        const yourName = "Your Boo"; 
        const photos = [
            { src: "b1.png", caption: "Our first amazing adventure!" },
            { src: "b2.png", caption: "That hilarious moment we shared." },
            { src: "b3.png", caption: "You looked so beautiful here." },
        ];
        const personalMessage = `Dearest ${girlfriendName},\n\nEvery day with you feels like a celebration, but today is extra special.\nI wanted to create something unique to show you just how much you mean to me.\n\nHere are a few reasons why I adore you:\n- Your incredible smile that lights up my world.\n- Your kindness and compassion towards everyone.\n- The way you make me laugh even on tough days.\n- Your strength and determination.\n- Simply put, you make my life better in every single way.\n\nHappy Birthday, my love. I hope this little surprise brings a smile to your face.\nI can't wait to celebrate many more birthdays with you.\n\nAll my love,\n${yourName}`;
        const songURL = "birthday.mp3"; 
        const songTitle = "Our Special Song"; 
        const balloonPopSoundURL = "button-09.mp3"; 
        const cheerSoundURL = "applause-01.mp3"; 
        // --- END OF CONFIGURATION ---

        let currentSection = 0;
        const sections = document.querySelectorAll('.section');
        let backgroundMusic;
        let popSound;
        let cheerSound;
        let candlesBlownOut = false;

        function initSounds() {
            console.log("Initializing sounds...");
            if (songURL) {
                backgroundMusic = new Howl({ src: [songURL], loop: true, volume: 0.3, html5: true });
                console.log("Background music Howl object created.");
            } else { console.warn("Background music URL not set."); }
            if (balloonPopSoundURL) popSound = new Howl({ src: [balloonPopSoundURL], volume: 0.7 });
            if (cheerSoundURL) cheerSound = new Howl({ src: [cheerSoundURL], volume: 0.8 });
            console.log("Sound effects Howl objects created.");
        }

        const tsParticlesConfig = { fullScreen: { enable: false }, particles: { number: { value: 80, density: { enable: true, value_area: 800 } }, color: { value: "#ffffff" }, shape: { type: "circle" }, opacity: { value: 0.5, random: false, anim: { enable: false, speed: 1, opacity_min: 0.1, sync: false } }, size: { value: 3, random: true, anim: { enable: false, speed: 40, size_min: 0.1, sync: false } }, line_linked: { enable: true, distance: 150, color: "#ffffff", opacity: 0.4, width: 1 }, move: { enable: true, speed: 2, direction: "none", random: false, straight: false, out_mode: "out", attract: { enable: false, rotateX: 600, rotateY: 1200 } } }, interactivity: { detect_on: "canvas", events: { onhover: { enable: true, mode: "repulse" }, onclick: { enable: true, mode: "push" }, resize: true }, modes: { grab: { distance: 400, line_opacity: 1 }, bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 }, repulse: { distance: 100, duration: 0.4 }, push: { particles_nb: 4 }, remove: { particles_nb: 2 } } }, retina_detect: true };
        const confettiConfig = { fullScreen: { enable: false }, particles: { number: { value: 0 }, color: { value: ["#FFC0CB", "#FF69B4", "#FF1493", "#DB7093", "#ADD8E6", "#87CEEB"] }, shape: { type: "confetti", options: { confetti: { type: ["circle", "square", "triangle", "star"] } } }, opacity: { value: { min: 0.5, max: 1 }, animation: { enable: true, speed: 2, minimumValue: 0, sync: false, destroy: "life" } }, size: { value: { min: 2, max: 8 } }, life: { duration: { sync: true, value: 3 }, count: 1 }, move: { enable: true, gravity: { enable: true, acceleration: 20 }, speed: {min: 10, max: 30}, decay: 0.05, direction: "top", random: true, straight: false, outModes: { default: "destroy", top: "none" } }, rotate: { value: { min: 0, max: 360 }, direction: "random", animation: { enable: true, speed: 60 } }, tilt: { direction: "random", enable: true, value: {min: 0, max: 360}, animation: {enable: true, speed: 60} }, roll: { darken: { enable: true, value: 25 }, enable: true, speed: { min: 15, max: 25 } }, wobble: { distance: 30, enable: true, speed: {min: -15, max: 15} } }, emitters: { position: { x: 50, y: 50 }, rate: { quantity: 100, delay: 0.1 }, life: { duration: 0.1, count: 1 } } };

        function showSection(index) {
            console.log(`showSection called with index: ${index}`);
            sections.forEach((sectionElement, i) => {
                if (i === index) {
                    console.log(`Activating section ${i} (${sectionElement.id || 'no id'})`);
                    sectionElement.classList.add('active');
                    gsap.fromTo(sectionElement, 
                        { autoAlpha: 0, y: 50 }, 
                        { 
                            autoAlpha: 1, y: 0, duration: 0.8, ease: "power2.out",
                            onComplete: () => console.log(`GSAP animation TO VISIBLE complete for section ${i} (${sectionElement.id || 'no id'})`) 
                        }
                    );
                } else {
                    if (sectionElement.classList.contains('active')) {
                        console.log(`Deactivating section ${i} (${sectionElement.id || 'no id'})`);
                    }
                    sectionElement.classList.remove('active');
                    gsap.to(sectionElement, { 
                        autoAlpha: 0, 
                        duration: 0.5, // Give fade out a duration
                        onComplete: () => console.log(`GSAP animation TO HIDDEN complete for section ${i} (${sectionElement.id || 'no id'})`) 
                    }); 
                }
            });
            console.log("Section class toggling and GSAP main animation init done for index: " + index);

            if (index === 0) { 
                console.log("Setting up Loading Screen (section 0) particles");
                tsParticles.load("particles-js-loading", { ...tsParticlesConfig, particles: {...tsParticlesConfig.particles, color: {value: "#FFF"}, line_linked: { color: "#FFF" } } });
            }
            if (index === 1) { 
                console.log("Setting up Welcome Screen (section 1)");
                gsap.from("#welcome-text", { opacity: 0, scale: 0.5, duration: 1, delay: 0.5, ease: "elastic.out(1, 0.5)" });
                
                console.log("DEBUG: Skipping tsParticles.load for welcome screen.");
                // tsParticles.load("particles-js-welcome", tsParticlesConfig); 
                
                if (backgroundMusic && !backgroundMusic.playing()) {
                    console.log("Attempting to play background music.");
                    backgroundMusic.play(); 
                }
                console.log("Welcome Screen (section 1) JS setup logic complete.");
            }
            if (index === 2) { createBalloons(10); }
            if (index === 4) { animateFlames(); }
            if (index === 5) { typeMessage(personalMessage, 'typed-message'); }
            if (index === 6 && backgroundMusic && !backgroundMusic.playing()) { backgroundMusic.play(); }
        }

        function nextSection() {
            console.log(`nextSection called. currentSection: ${currentSection}`);
            if (currentSection < sections.length - 1) {
                if (currentSection === 1 && backgroundMusic && !backgroundMusic.playing()) {
                    console.log("Music not playing on welcome screen, playing via nextSection.");
                    backgroundMusic.play();
                }
                currentSection++;
                showSection(currentSection);
            } else { console.log("Already on last section."); }
        }

        function replaySurprise() {
            console.log("replaySurprise called.");
            if (backgroundMusic && backgroundMusic.playing()) { backgroundMusic.stop(); }
            
            document.querySelectorAll('.flame').forEach(flame => { flame.style.display = 'block'; gsap.set(flame, { opacity: 1 }); });
            document.getElementById('cake-message').textContent = "Click the cake to blow out the candles!";
            document.getElementById('cake-next-button').style.display = 'none';
            candlesBlownOut = false; 
            console.log("Cake state reset. candlesBlownOut:", candlesBlownOut);

            currentSection = 1; 
            showSection(currentSection); 
        }

        function createBalloons(count) { const c = document.getElementById('balloon-field'); c.innerHTML = ''; const clrs = ['#FF6347', '#4682B4', '#32CD32', '#FFD700', '#6A5ACD', '#FF69B4']; for (let i=0;i<count;i++) { const b=document.createElement('div');b.classList.add('balloon');b.style.backgroundColor=clrs[i%clrs.length];b.style.left=`${Math.random()*85}%`;b.style.bottom=`-${Math.random()*100+50}px`;b.addEventListener('click',()=>popBalloon(b));c.appendChild(b);gsap.to(b,{y:`-${window.innerHeight*.8+Math.random()*100}`,x:`${(Math.random()-.5)*100}`,rotation:`${(Math.random()-.5)*30}`,duration:Math.random()*5+5,ease:"sine.inOut",repeat:-1,yoyo:true,delay:Math.random()*2});}}
        function popBalloon(b) { if(popSound)popSound.play();const r=b.getBoundingClientRect();const ce={...confettiConfig.emitters,p:{x:(r.left+r.width/2)*100/window.innerWidth,y:(r.top+r.height/2)*100/window.innerHeight}};tsParticles.load({particles:confettiConfig.particles,emitters:ce});gsap.to(b,{scale:0,opacity:0,duration:.3,onComplete:()=>b.remove()});}
        function animateFlames() { document.querySelectorAll('.flame').forEach(f=>{gsap.to(f,{scaleY:1.1,scaleX:1.05,skewX:"random(-5,5)",duration:"random(.2,.5)",repeat:-1,yoyo:true,ease:"sine.inOut"});});}
        function blowOutCandles() { if(candlesBlownOut)return;candlesBlownOut=true;if(cheerSound)cheerSound.play();document.querySelectorAll('.flame').forEach(f=>{gsap.to(f,{opacity:0,duration:.5,onComplete:()=>f.style.display='none'});});document.getElementById('cake-message').textContent="Woohoo! Happy Birthday!";const cr=document.getElementById('cake-container').getBoundingClientRect();const ce={...confettiConfig.emitters,p:{x:(cr.left+cr.width/2)*100/window.innerWidth,y:(cr.top+cr.height/4)*100/window.innerHeight},rate:{quantity:200,delay:.05}};tsParticles.load({particles:confettiConfig.particles,emitters:ce});gsap.to("#cake-next-button",{display:'inline-block',opacity:1,duration:.5,delay:1});}
        function typeMessage(m,eId,s=50){const el=document.getElementById(eId);el.innerHTML="";let i=0;function t(){if(i<m.length){el.innerHTML+=m.charAt(i);i++;setTimeout(t,s)}}t()}
        function initSwiper() { const w=document.querySelector('#gallery-screen .swiper-wrapper');w.innerHTML='';photos.forEach(p=>{const s=document.createElement('div');s.classList.add('swiper-slide');const i=document.createElement('img');i.src=p.src;i.alt=p.caption;const capt=document.createElement('p');capt.textContent=p.caption;s.appendChild(i);s.appendChild(capt);w.appendChild(s)});new Swiper('.swiper-container',{loop:true,grabCursor:true,effect:'cube',cubeEffect:{shadow:true,slideShadows:true,shadowOffset:20,shadowScale:.94},pagination:{el:'.swiper-pagination',clickable:true},navigation:{nextEl:'.swiper-button-next',prevEl:'.swiper-button-prev'},autoplay:{delay:4000,disableOnInteraction:false}});}

        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOMContentLoaded event fired.");
            // Set dynamic text content
            document.getElementById('welcome-text').textContent = `Happy Birthday, ${girlfriendName}!`;
            document.querySelector('#final-screen h1').textContent = `I Love You, ${girlfriendName}!`;
            document.querySelector('#final-screen p:nth-of-type(2)').innerHTML = `With all my love,<br>${yourName}`;

            // Set HTML5 audio source if using it (Howler is primary for backgroundMusic)
            const birthdaySongElement = document.getElementById('birthday-song');
            if (birthdaySongElement) birthdaySongElement.src = songURL; 
            const songTitleElement = document.getElementById('song-title');
            if(songTitleElement) songTitleElement.textContent = `Song: ${songTitle}`;

            initSounds();
            initSwiper();
            console.log("Initial sounds and swiper initialized.");

            // Set initial GSAP states for all sections
            // All sections start hidden (autoAlpha: 0) except the one with .active class
            console.log("Setting initial GSAP states for sections...");
            sections.forEach((s, i) => {
                if (s.classList.contains('active')) { // Should be loading-screen
                    gsap.set(s, { autoAlpha: 1, y: 0 }); // Make sure it's visible and at y:0
                    console.log(`Section ${i} (${s.id}) is active, set to autoAlpha:1, y:0`);
                    // Call showSection to trigger its specific logic (e.g., particles for loading screen)
                    // Only if currentSection is indeed this one (which it should be if HTML has .active)
                    if (currentSection === i) {
                        showSection(i); // This will load particles for section 0
                    }
                } else {
                    gsap.set(s, { autoAlpha: 0, y: 50 }); // Others start hidden and offset
                    console.log(`Section ${i} (${s.id}) is not active, set to autoAlpha:0, y:50`);
                }
            });
            console.log("Initial GSAP states set.");


            setTimeout(() => {
                console.log("Timeout finished. Attempting to destroy loading particles.");
                const allParticlesInstances = tsParticles.dom();
                let loadingParticlesInstance = null;
                for (const instance of allParticlesInstances) {
                    if (instance.id === "particles-js-loading" || (instance.sourceOptions && instance.sourceOptions.id === "particles-js-loading")) {
                        loadingParticlesInstance = instance;
                        break;
                    }
                    if (instance.canvas && instance.canvas.element && instance.canvas.element.parentElement && instance.canvas.element.parentElement.id === "particles-js-loading") {
                        loadingParticlesInstance = instance;
                        break;
                    }
                }

                if (loadingParticlesInstance) {
                    console.log("Found loading particles instance, destroying...");
                    loadingParticlesInstance.destroy();
                    console.log("Loading particles destroyed.");
                } else {
                    console.log("No loading particles instance for 'particles-js-loading' found to destroy.");
                }
                
                currentSection = 1; 
                console.log("Calling showSection to display Welcome Screen (index 1).");
                showSection(currentSection);
                console.log("Returned from initial showSection(1) call.");
            }, 3000); 
        });
    </script>
</body>
</html